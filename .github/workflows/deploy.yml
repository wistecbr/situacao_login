name: ðŸš€ Deploy website on push

on:
  push:
    branches:
      - main
      - develop
jobs:
  web-deploy:
    name: ðŸŽ‰ Deploy
    runs-on: ubuntu-latest
    steps:
      - name: ðŸšš Get latest code
        uses: actions/checkout@v3

      - name: ðŸšš Create .env and HOST
        run: echo HOST='"${{secrets.db_host}}"' > .env

      - name: ðŸšš Set User .env
        run: echo USER='"${{secrets.db_user}}"' >> .env

      - name: ðŸšš Set Pass .env
        run: echo PASSWORD='"${{secrets.db_pass}}"' >> .env

      - name: ðŸšš Set DataBase .env
        run: echo DATABASE='"${{secrets.db_database}}"' >> .env

      - name: Extract branch name
        id: extract_branch
        env:
          GITHUB_REF: ${{github.ref}}
        run: echo "::set-output name=name::${GITHUB_REF#refs/heads/}"

      - name: Get branch name
        id: set_local_dir
        env:
          BRANCH_NAME: ${{steps.extract_branch.outputs.name}}
        run: echo "::set-output name=name::$BRANCH_NAME"

      - name: ðŸ“‚ Sync files
        uses: SamKirkland/FTP-Deploy-Action@4.2.0
        env: 
          LOCAL_DIR: ${{steps.set_local_dir.outputs.name}}
        with:
          server: ${{ secrets.ftp_host }}
          username: ${{ secrets.ftp_user }}
          password: ${{ secrets.ftp_pass }}
          server-dir: $LOCAL_DIR
